<!DOCTYPE html>
<html>
	<head>
		<title>BurgerMaster</title>
		<meta charset="utf-8">

		<link href="fonts/font.css" rel="stylesheet" type="text/css">
		<link href="styles/style.css" rel="stylesheet" type="text/css">
		<script src="lib/createjs-2013.12.12.min.js"></script>
		<script>
			var canvas;
			var stage;
			var pileContainer;
			var queue;
			var loadingText;

			var currentText;
			var mausteOffset;
			var pileHeight;

			var mausteList;
			var hampurilaiset;

			function init() {
				canvas = document.getElementById("gameCanvas");
				stage = new createjs.Stage(canvas);
				createjs.Touch.enable(stage);

				loadingText = new createjs.Text("Loading...", "24px Averia Sans Libre", "#000000");
				loadingText.x = canvas.width * 0.45;
				loadingText.y = canvas.height * 0.5;
				stage.addChild(loadingText);
				stage.update();

				queue = new createjs.LoadQueue();
				createjs.Sound.alternateExtensions = ["mp3"];
				queue.installPlugin(createjs.Sound);
				queue.addEventListener("complete", handleComplete);

				// Mauste and mausteastia graphics
				mausteList = ["sinappi", "ketsuppi", "sipuli", "kurkku", "juusto", "salaatti", "tomaatti", "paprikamajoneesi", "kurkkumajoneesi", "kansi", "vali", "pohja", "pihvi_pieni", "pihvi_iso", "pekoni"];
				for (var i = 0; i < mausteList.length; i++) {
					queue.loadFile({id: mausteList[i], src: "assets/mausteastiat/" + mausteList[i] + ".png"});
					queue.loadFile({id: "mauste_" + mausteList[i], src: "assets/mausteet/" + mausteList[i] + ".png"});
				}

				// Other files
				queue.loadManifest([
						{id: "sound_blop", src: "assets/sound/blop.ogg"},
						{id: "sound_ketchup", src: "assets/sound/ketchup.ogg"},
						{id: "background", src: "assets/misc/background.png"},
						{id: "hampurilaiset", src: "assets/hampurilaiset.json"}
				]);

				mausteOffset = 0;
				pileHeight = 0;
			}

			function handleComplete(event) {
				stage.removeChild(loadingText);

				var background = new createjs.Bitmap(queue.getResult("background"));
				stage.addChild(background);

				hampurilaiset = queue.getResult("hampurilaiset");
				console.log("Hampurilaisten kokonaismäärä: " + hampurilaiset["hampurilaiset"].length);
				console.log("Nimi: " + hampurilaiset["hampurilaiset"][0]["name"]);
				console.log("Mausteiden määrä: " + hampurilaiset["hampurilaiset"][0]["mausteet"].length);
				console.log("Mausteet: " + hampurilaiset["hampurilaiset"][0]["mausteet"]);

				initGui();
				initAstiat();

				pileContainer = new createjs.Container();
				stage.addChild(pileContainer);

				createjs.Ticker.addEventListener("tick", tick);



			}

			function addMauste(event) {
				var mausteIsCorrect = true;

				// TODO: if mauste is not correct
				if (false) {
					mausteIsCorrect = false;
				}

				if (mausteIsCorrect) {
					// Purukumi:
					var imageSource = event.target.image.src.split("/");
					var fileName = imageSource[imageSource.length-1];
					var mausteId = fileName.substring(0, fileName.length-4);

					var bmp = new createjs.Bitmap(queue.getResult("mauste_" + mausteId));

					if (mausteId == "kansi") {
						mausteOffset += canvas.height * 0.06;
					}
					else if (mausteId == "vali") {
						mausteOffset -= canvas.height * 0.012;
					}

					bmp.regX = bmp.image.width/2|0;
					bmp.regY = bmp.image.height/2|0;
					bmp.scaleX = 0.5;
					bmp.scaleY = 0.5;
					bmp.x = canvas.width * 0.5;
					bmp.y = canvas.height * 0.65 - mausteOffset;

					mausteOffset += canvas.height * 0.016;
					pileHeight++;

					pileContainer.addChild(bmp);
					
					if ((mausteId == "ketsuppi") || (mausteId == "sinappi") || (mausteId == "kurkkumajoneesi") || (mausteId == "paprikamajoneesi")) {
						createjs.Sound.play("sound_ketchup").volume = 0.5;
					}
					else {
						createjs.Sound.play("sound_blop").volume = 0.5;
					}
				}
				else {
					// next burger
				}

			}

			function initGui() {
				var kasaaText = new createjs.Text("Kasaa:", "30px Averia Sans Libre", "#444444");
				kasaaText.x = canvas.width * 0.02;
				kasaaText.y = canvas.height * 0.9;
				stage.addChild(kasaaText);

				currentText = new createjs.Text("<hampurilaista ei ole asetettu>", "30px Averia Sans Libre", "#000000");
				currentText.x = canvas.width * 0.12;
				currentText.y = canvas.height * 0.9;
				stage.addChild(currentText);
			}

			function initAstiat() {
				var pohjaText = new createjs.Text("reset", "24px Averia Sans Libre", "#666");
				pohjaText.addEventListener("click", function() {
					pileContainer.removeAllChildren();
					mausteOffset = 0;
				});
				pohjaText.x = canvas.width * 0.9;
				pohjaText.y = canvas.height * 0.9;
				stage.addChild(pohjaText);

				var astiaOffset = 0;

				// sinappi ja ketsuppi
				for (i = 0; i <= 1; i++) {
					var astia = new createjs.Bitmap(queue.getResult(mausteList[i]));
					astia.addEventListener("click", addMauste);
					astia.regX = astia.image.width/2|0;
					astia.regY = astia.image.height/2|0;
					astia.x = canvas.width * 0.21;
					astia.y = canvas.height * 0.25 + astiaOffset;
					astiaOffset += canvas.height * 0.17;
					stage.addChild(astia);
				}

				astiaOffset = 0;

				// sipuli...tomaatti
				for (i = 2; i <= 6; i++) {
					var astia = new createjs.Bitmap(queue.getResult(mausteList[i]));
					astia.addEventListener("click", addMauste);
					astia.regX = astia.image.width/2|0;
					astia.regY = astia.image.height/2|0;
					astia.x = canvas.width * 0.26 + astiaOffset;
					astia.y = canvas.height * 0.1;
					astiaOffset += canvas.width * 0.12;
					stage.addChild(astia);
				}

				astiaOffset = 0;

				// kurkkumajoneesi ja paprikamajoneesi
				for (i = 7; i <= 8; i++) {
					var astia = new createjs.Bitmap(queue.getResult(mausteList[i]));
					astia.addEventListener("click", addMauste);
					astia.regX = astia.image.width/2|0;
					astia.regY = astia.image.height/2|0;
					astia.x = canvas.width * 0.79;
					astia.y = canvas.height * 0.25 + astiaOffset;
					astiaOffset += canvas.height * 0.17;
					stage.addChild(astia);
				}

				astiaOffset = 0;

				// sämpylät
				for (i = 9; i <= 11; i++) {
					var astia = new createjs.Bitmap(queue.getResult(mausteList[i]));
					astia.addEventListener("click", addMauste);
					astia.regX = astia.image.width/2|0;
					astia.regY = astia.image.height/2|0;
					astia.x = canvas.width * 0.08;
					astia.y = canvas.height * 0.12 + astiaOffset;
					astiaOffset += canvas.height * 0.18;
					stage.addChild(astia);
				}

				astiaOffset = 0;

				// lihat
				for (i = 12; i <= 14; i++) {
					var astia = new createjs.Bitmap(queue.getResult(mausteList[i]));
					astia.addEventListener("click", addMauste);
					astia.regX = astia.image.width/2|0;
					astia.regY = astia.image.height/2|0;
					astia.x = canvas.width * 0.92;
					astia.y = canvas.height * 0.12 + astiaOffset;
					astiaOffset += canvas.height * 0.18;
					stage.addChild(astia);
				}

			}

			function tick(event) {
				stage.update();
			}

		</script>
	</head>

	<body onLoad="init()">
		<div id="canvasContainer">
			<canvas id="gameCanvas" width="960" height="540">Selaimesi ei tue HTML5:n canvas-elementtiä</canvas>
		</div>
	</body>

</html>